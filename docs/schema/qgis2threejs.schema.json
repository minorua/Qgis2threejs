{
  "$id": "https://example.com/schema/qgis2threejs.schema.json",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Qgis2threejs Pythonâ†’Web Data",
  "description": "Schema for JSON objects exchanged between Python export and Web viewer (scene, layer, block).",
  "type": "object",
  "oneOf": [
    { "$ref": "#/$defs/Scene" },
    { "$ref": "#/$defs/Layer" },
    { "$ref": "#/$defs/Block" }
  ],
  "$defs": {
    "Scene": {
      "type": "object",
      "required": ["type", "properties"],
      "additionalProperties": false,
      "properties": {
        "type": { "const": "scene" },
        "properties": { "$ref": "#/$defs/SceneProperties" },
        "layers": {
          "type": "array",
          "items": { "$ref": "#/$defs/Layer" }
        }
      }
    },

    "SceneProperties": {
      "type": "object",
      "required": ["baseExtent", "origin", "zScale", "light"],
      "additionalProperties": false,
      "properties": {
        "baseExtent": { "$ref": "#/$defs/BaseExtent" },
        "origin": { "$ref": "#/$defs/Vec3" },
        "zScale": { "type": "number" },
        "light": { "type": "string", "enum": ["point", "directional"] },
        "fog": {
          "type": "object",
          "additionalProperties": false,
          "required": ["color", "density"],
          "properties": {
            "color": { "type": "integer" },
            "density": { "type": "number", "minimum": 0 }
          }
        },
        "proj": { "type": "string" }
      }
    },

    "BaseExtent": {
      "type": "object",
      "required": ["cx", "cy", "width", "height", "rotation"],
      "additionalProperties": false,
      "properties": {
        "cx": { "type": "number" },
        "cy": { "type": "number" },
        "width": { "type": "number", "exclusiveMinimum": 0 },
        "height": { "type": "number", "exclusiveMinimum": 0 },
        "rotation": { "type": "number" }
      }
    },

    "Vec3": {
      "type": "object",
      "required": ["x", "y", "z"],
      "additionalProperties": false,
      "properties": {
        "x": { "type": "number" },
        "y": { "type": "number" },
        "z": { "type": "number" }
      }
    },

    "Layer": {
      "type": "object",
      "required": ["type", "id", "properties"],
      "additionalProperties": false,
      "properties": {
        "type": { "const": "layer" },
        "id": { "type": "string", "minLength": 1 },
        "properties": { "$ref": "#/$defs/LayerProperties" },
        "body": { "$ref": "#/$defs/LayerBody" },
        "PROPERTIES": { "type": ["object", "null"] }
      }
    },

    "LayerProperties": {
      "type": "object",
      "required": ["name", "clickable", "visible", "type"],
      "additionalProperties": true,
      "properties": {
        "name": { "type": "string" },
        "clickable": { "type": "boolean" },
        "visible": { "type": "boolean" },
        "type": { "type": "string", "enum": ["dem", "point", "line", "polygon", "pc"] },
        "objType": { "type": "string" },
        "propertyNames": { "type": "array", "items": { "type": "string" } },
        "label": {
          "type": "object",
          "additionalProperties": true,
          "properties": {
            "relative": { "type": "boolean" },
            "font": { "type": "string" },
            "size": { "type": "number" },
            "color": { "type": "string" },
            "olcolor": { "type": "string" },
            "bgcolor": { "type": "string" },
            "cncolor": { "type": ["integer", "string"] },
            "underline": { "type": "boolean" }
          }
        },

        "clipped": { "type": "boolean" },
        "mtlNames": { "type": "array", "items": { "type": "string" } },
        "mtlIdx": { "type": "integer", "minimum": 0 },

        "url": { "type": "string" },
        "opacity": { "type": "number", "minimum": 0, "maximum": 1 },
        "colorType": { "type": "string", "enum": ["RGB", "COLOR", "ELEVATION", "INTENSITY", "CLASSIFICATION"] },
        "color": { "type": "integer" },
        "boxVisible": { "type": "boolean" }
      }
    },

    "LayerBody": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "materials": { "type": "array", "items": { "$ref": "#/$defs/Material" } },
        "models": { "type": "array", "items": { "$ref": "#/$defs/Model" } },
        "blocks": {
          "type": "array",
          "items": {
            "oneOf": [
              { "$ref": "#/$defs/Block" },
              { "$ref": "#/$defs/BlockFileRef" }
            ]
          }
        }
      }
    },

    "Model": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "url": { "type": "string" },
        "base64": { "type": "string" },
        "ext": { "type": "string" },
        "resourcePath": { "type": "string" }
      },
      "anyOf": [
        { "required": ["url"] },
        { "required": ["base64", "ext", "resourcePath"] }
      ]
    },

    "Material": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "type": { "type": "integer", "enum": [0,1,2,3,4,5,6] },
        "image": {
          "type": "object",
          "additionalProperties": true,
          "properties": {
            "url": { "type": "string" },
            "base64": { "type": "string" },
            "object": {}
          }
        },
        "c": { "type": "integer" },
        "s": { "type": ["number", "integer"] },
        "dashed": { "type": "boolean" },
        "thickness": { "type": ["number", "integer"] },
        "t": { "type": ["boolean", "integer"] },
        "w": { "type": ["boolean", "integer"] },
        "flat": { "type": ["boolean", "integer"] },
        "o": { "type": "number", "minimum": 0, "maximum": 1 },
        "ds": { "type": ["boolean", "integer"] },
        "bm": { "type": "boolean" },
        "mtlIndex": { "type": "integer" },
        "useNow": { "type": "boolean" }
      }
    },

    "Block": {
      "type": "object",
      "required": ["type", "layer", "block"],
      "properties": {
        "type": { "const": "block" },
        "layer": { "type": "string" },
        "block": { "type": "integer", "minimum": 0 },
        "features": { "type": "array", "items": { "$ref": "#/$defs/Feature" } },
        "featureCount": { "type": "integer", "minimum": 0 },
        "startIndex": { "type": "integer", "minimum": 0 },

        "width": { "type": "number" },
        "height": { "type": "number" },
        "translate": { "$ref": "#/$defs/Translate" },
        "zScale": { "type": "number" },
        "grid": { "$ref": "#/$defs/DEMGrid" },
        "geom": { "$ref": "#/$defs/Geometry" },
        "sides": { "$ref": "#/$defs/Sides" },
        "edges": { "$ref": "#/$defs/Edges" },
        "wireframe": { "$ref": "#/$defs/Wireframe" },

        "materials": { "type": "array", "items": { "$ref": "#/$defs/Material" } }
      },
      "additionalProperties": false
    },

    "BlockFileRef": {
      "type": "object",
      "required": ["url", "featureCount"],
      "additionalProperties": false,
      "properties": {
        "url": { "type": "string" },
        "featureCount": { "type": "integer", "minimum": 0 }
      }
    },

    "Translate": {
      "type": "array",
      "items": [ {"type": "number"}, {"type": "number"}, {"type": "number"} ],
      "minItems": 3,
      "maxItems": 3
    },

    "DEMGrid": {
      "type": "object",
      "required": ["width", "height"],
      "additionalProperties": false,
      "properties": {
        "width": { "type": "integer", "minimum": 2 },
        "height": { "type": "integer", "minimum": 2 },
        "array": { "$ref": "#/$defs/NumberArray" },
        "url": { "type": "string" },
        "binary": {}
      },
      "anyOf": [
        { "required": ["array"] },
        { "required": ["url"] },
        { "required": ["binary"] }
      ]
    },

    "Sides": {
      "type": "object",
      "required": ["mtl", "bottom"],
      "additionalProperties": false,
      "properties": {
        "mtl": { "$ref": "#/$defs/Material" },
        "bottom": { "type": "number" }
      }
    },

    "Edges": {
      "type": "object",
      "required": ["mtl"],
      "additionalProperties": false,
      "properties": { "mtl": { "$ref": "#/$defs/Material" } }
    },

    "Wireframe": {
      "type": "object",
      "required": ["mtl"],
      "additionalProperties": false,
      "properties": { "mtl": { "$ref": "#/$defs/Material" } }
    },

    "Feature": {
      "type": "object",
      "required": ["geom"],
      "additionalProperties": false,
      "properties": {
        "geom": { "$ref": "#/$defs/Geometry" },
        "mtl": { "$ref": "#/$defs/MaterialRef" },
        "model": { "$ref": "#/$defs/ModelRef" },
        "prop": { "type": "object", "additionalProperties": true },
        "lbl": { "type": "string" },
        "lh": { "type": ["number", "integer"] },
        "anim": { "$ref": "#/$defs/Anim" }
      }
    },

    "MaterialRef": {
      "type": "object",
      "additionalProperties": false,
      "properties": { "idx": { "type": "integer", "minimum": 0 } },
      "required": ["idx"]
    },

    "ModelRef": {
      "type": "object",
      "additionalProperties": true,
      "properties": {
        "idx": { "type": "integer", "minimum": 0 }
      }
    },

    "Anim": {
      "type": "object",
      "required": ["delay", "duration"],
      "additionalProperties": false,
      "properties": {
        "delay": { "type": "integer", "minimum": 0 },
        "duration": { "type": "integer", "minimum": 0 }
      }
    },

    "Geometry": {
      "type": "object",
      "additionalProperties": true,
      "oneOf": [
        { "$ref": "#/$defs/GeomPoints" },
        { "$ref": "#/$defs/GeomLines" },
        { "$ref": "#/$defs/GeomTriangles" }
      ]
    },

    "GeomPoints": {
      "type": "object",
      "required": ["pts"],
      "additionalProperties": false,
      "properties": { "pts": { "$ref": "#/$defs/NumberArray3N" } }
    },

    "GeomLines": {
      "type": "object",
      "required": ["lines"],
      "additionalProperties": false,
      "properties": {
        "lines": {
          "type": "array",
          "items": { "$ref": "#/$defs/NumberArray3N" }
        }
      }
    },

    "GeomTriangles": {
      "type": "object",
      "required": ["triangles"],
      "additionalProperties": true,
      "properties": {
        "triangles": {
          "type": "object",
          "required": ["v", "f"],
          "additionalProperties": false,
          "properties": {
            "v": {
              "type": "array",
              "items": {
                "oneOf": [
                  { "$ref": "#/$defs/NumberTuple3" },
                  { "$ref": "#/$defs/NumberArray3N" }
                ]
              }
            },
            "f": {
              "type": "array",
              "items": {
                "oneOf": [
                  { "$ref": "#/$defs/IntegerTuple3" },
                  { "$ref": "#/$defs/IntegerArray3N" }
                ]
              }
            }
          }
        },
        "polygons": {
          "type": "array",
          "items": { "$ref": "#/$defs/NumberArray3N" }
        },
        "centroids": { "$ref": "#/$defs/ArrayOfVec3" },
        "h": { "type": ["number", "integer"] }
      }
    },

    "NumberArray": {
      "type": "array",
      "items": { "type": "number" }
    },
    "IntegerArray": {
      "type": "array",
      "items": { "type": "integer" }
    },
    "NumberArray3N": {
      "type": "array",
      "items": { "type": "number" },
      "minItems": 3
    },
    "IntegerArray3N": {
      "type": "array",
      "items": { "type": "integer" },
      "minItems": 3
    },
    "NumberTuple3": {
      "type": "array",
      "items": [ {"type": "number"}, {"type": "number"}, {"type": "number"} ],
      "minItems": 3,
      "maxItems": 3
    },
    "IntegerTuple3": {
      "type": "array",
      "items": [ {"type": "integer"}, {"type": "integer"}, {"type": "integer"} ],
      "minItems": 3,
      "maxItems": 3
    },
    "ArrayOfVec3": {
      "type": "array",
      "items": { "$ref": "#/$defs/NumberTuple3" }
    }
  }
}
